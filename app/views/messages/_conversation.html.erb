<div id="conversation" class="h-full">
  <% if recipient %>

    <div class="h-full flex flex-col">
      <div class="flex p-3">
        <div class="flex items-center">
          <%= image_tag recipient.avatar_name, class: 'rounded-full w-12 h-12 object-cover mr-2' %>
          <div>
            <div class="font-semibold"><%= recipient.name %></div>
            <div class="text-gray-500">@<%= recipient.uid %></div>
          </div>
        </div>
      </div>

      <!-- Send messages here -->
      <!--<%#= turbo_stream_from Message::ConversationId.call(current_user.messages.new(recipient: recipient)) %>-->
      <%= turbo_stream_from current_user.messages.new(recipient: recipient).stream_name_for_author %>

      <div class="flex-1 p-3">
        <div
          id="<%= current_user.messages.new(recipient: recipient).stream_name_for_author %>"
          class="flex flex-col justify-end h-full"
        >
          <% @messages.each do |message| %>
            <%= render message, is_author: message.user == current_user %>
          <% end %>
        </div>
      </div>

      <div class="border-t border-gray-700 p-3">
        <%= form_with model: current_user.messages.new(recipient: recipient),
          data: { controller: 'reset-form', action: 'turbo:submit-end->reset-form#reset' },
          html: { autocomplete: 'off' } do |form|
        %>

          <div class="flex items-center">
            <!--
              focus-within: pseudo class which matches if any children is focused.
              For div, focus doesn't work but focus-within works if it has focusable input fields.
            -->
            <div class="flex flex-1 items-center border border-sky-500 rounded-full px-4 py-1 focus-within:ring-2">
              <%=
                form.text_field :content,
                  placeholder: "Start a new message",
                  class: "bg-black border-none focus:ring-0 w-full"
              %>
              <%= form.hidden_field :recipient_id, value: recipient.id %>
              <%# <i class="fa fa-smile"></i> %>
            </div>
            <button type="submit">
              <i class="fa fa-paper-plane ml-3 text-sky-500"></i>
            </button>
          </div>
        <% end %>
      </div>

    </div>

  <% else %>
    <div class="h-full flex justify-center items-center">Please select a conversation.</div>
  <% end %>
</div>
